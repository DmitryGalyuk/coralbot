<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style>
        .node rect {
            fill: #999;
            stroke-width: 1.5px;
        }

        .node text {
            font: 10px sans-serif;
            pointer-events: none;
        }

        .link {
            fill: none;
            stroke: #000;
            stroke-opacity: 0.2;
        }

        .link:hover {
            stroke-opacity: 0.5;
        }
    </style>

    <script src="https://d3js.org/d3.v6.js"></script>
    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->

    <!-- <script src="https://unpkg.com/d3-array@1"></script>
    <script src="https://unpkg.com/d3-collection@1"></script>
    <script src="https://unpkg.com/d3-path@1"></script>
    <script src="https://unpkg.com/d3-shape@1"></script> -->
    <script src="https://unpkg.com/d3-sankey/dist/d3-sankey.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="js/parser.js" type="module"></script>
    <script src="js/member.js" type="module"></script>
    <script src="js/render.js" type="module"></script>
    <script src="js/sankey.js"></script>

    <script type="module">
        import ReportParses from './js/parser.js'
        import Renderer from './js/render.js'
        import Member from './js/member.js'

        async function parseUploaded() {
            const file = document.querySelector('#excelFile').files[0];
            let parser = new ReportParses(file);

            let data = await parser.parseExcel();
            Member.removeZeroMembers(data);

            let renderer = new Renderer(data);

            let s = chart(d3, renderer.renderSankeyData(), "source");
            document.getElementById("diagram").appendChild(s);
        }



            document.getElementById("btnParse").addEventListener('click', parseUploaded);
    </script>
</head>

<body>

    Выбрать файл отчёта <input type="file" id="excelFile" />

    <button id="btnParse">Загрузить</button>

    <div id="diagram"></div>

</body>

</html>